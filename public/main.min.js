function successCallback(o){window.stream=o,window.URL?video.src=window.URL.createObjectURL(o):video.src=o}function errorCallback(o){console.log("無法取得視訊串流 : ",o)}function snapshot(o){var e=document.querySelector("#"+o),t=e.getContext("2d"),a=450,n=800;stream&&(t.drawImage(video,0,0,a,n),currentSnapshot=e.toDataURL("image/png"))}function sendSnapshot(){snapshot("test"),$.ajax({type:"POST",data:currentSnapshot,url:"/snapshot",success:function(o){console.log("傳送照片成功～"),console.log(o)},beforeSend:function(){console.log("Ready to 傳送照片～")},error:function(o){console.log("傳送照片失敗!!!"),console.log(o)}})}function sendDeviceOrientation(){var o={alpha:alpha,beta:beta,gamma:gamma};$.ajax({type:"POST",data:o,url:"/deviceorientation",success:function(o){console.log("傳送陀螺儀資訊成功～"),console.log(o)},beforeSend:function(){console.log("Ready to 傳送陀螺儀資訊～")},error:function(o){console.log("傳送陀螺儀資訊失敗!!!"),console.log(o)}})}function locateSucess(o){positionData=o}function locateErr(o){var e={0:"不明原因錯誤",1:"使用者拒絕提供位置資訊",2:"無法取得位置資訊",3:"位置查詢逾時"};console.log("定位失敗: "+e[o])}function sendPosition(){var o={latitude:positionData.coords.latitude,longitude:positionData.coords.longitude,accuracy:positionData.coords.accuracy};$.ajax({type:"POST",data:o,url:"/position",success:function(o){console.log("傳送位置資訊成功～"),console.log(o)},beforeSend:function(){console.log("Ready to 傳送位置資訊～")},error:function(o){console.log("傳送位置資訊失敗!!"),console.log(o)}})}function ShowTestButton(){function o(){$("<p>",{"class":"testClass",id:"demo",style:"position:absolute; left:20vw;top:0; z-index:3;"}).appendTo("body"),setInterval(function(){console.log("main"),document.getElementById("demo").innerHTML="緯度: "+positionData.coords.latitude+"<br>經度: "+positionData.coords.longitude+"<br>方位: "+alpha+"<br>移動方向: "+positionData.coords.heading+"<br>移動速度: "+positionData.coords.speed+"<br>位置誤差: "+positionData.coords.accuracy+"<br>高度: "+positionData.coords.altitude},500)}function e(){$("<p>",{"class":"testClass",id:"alpha",style:"position:absolute; left:0;top:10vh; z-index:3;"}).appendTo("body"),$("<p>",{"class":"testClass",id:"beta",style:"position:absolute; left:0;top:20vh; z-index:3;"}).appendTo("body"),$("<p>",{"class":"testClass",id:"gamma",style:"position:absolute; left:0;top:30vh; z-index:3;"}).appendTo("body"),window.addEventListener("deviceorientation",function(o){document.getElementById("alpha").innerHTML=Math.round(alpha),document.getElementById("beta").innerHTML=Math.round(beta),document.getElementById("gamma").innerHTML=Math.round(gamma)},!1)}$("<button>",{"class":"testClass",id:"testGPS",style:"position:absolute; left:0;top:80vh; z-index:3;",text:"GPS"}).appendTo("body"),$("#testGPS").click(function(){o()}),$("<button>",{"class":"testClass",id:"testTLE",style:"position:absolute; left:20vw;top:80vh; z-index:3;",text:"TLE"}).appendTo("body"),$("#testTLE").click(function(){e()})}$("#logo").delay(1500).fadeOut(1e3),$("#hintBtn").click(function(){0==$.cookie("storyStage")?$("#noteWord").html("....."):1==$.cookie("storyStage")?$("#noteWord").html("從現世的光明<br><br>走入黑暗<br><br>走向過去<br><br>當你看到一絲曙光<br><br>向左走就對了..."):2==$.cookie("storyStage")?$("#noteWord").html("兩個岔路<br><br>繞成一個圓<br><br>殊途同歸<br><br>就像我們的人生一樣..."):3==$.cookie("storyStage")?$("#noteWord").html("去走走看看吧~<br><br>漂亮的布匹<br><br>手工藝品<br><br>還有，試著去體驗<br><br>這個地方曾經的樣子..."):5==$.cookie("storyStage")?$("#noteWord").html("江水流盡之時<br><br>順著不一樣的路走<br><br>成功就在不遠處..."):7==$.cookie("storyStage")&&$("#noteWord").html("這也要按提示！？<br><br>人生不就是要繼續向前走嗎？"),$(".note").fadeIn(500)}),$(".note").click(function(){$(".note").fadeOut(500)}),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var video=document.querySelector("#camera"),exArray=[];if(MediaStreamTrack.getSources(function(o){for(var e=0;e!=o.length;++e){var t=o[e];"video"===t.kind&&exArray.push(t.id)}navigator.getUserMedia({video:{optional:[{sourceId:exArray[1]}]}},successCallback,errorCallback)}),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(o){beta=o.beta,gamma=o.gamma,o.webkitCompassHeading?alpha=o.webkitCompassHeading:alpha=o.alpha,alpha>10&&alpha<80&&0==locationId?($(".npc").hide(),$("#n1").show()):alpha>100&&alpha<170&&1==locationId?($(".npc").hide(),$("#n2").show()):alpha>190&&alpha<260&&3==locationId?($(".npc").hide(),$("#n3").show()):alpha>280&&alpha<350&&4==locationId?($(".npc").hide(),$("#n4").show()):$(".npc").hide()},!1):console.log("不支援陀螺儀喔～～"),navigator.geolocation)var locate=function(){var o={enableAcuracy:!0,maximumAge:.5};navigator.geolocation.getCurrentPosition(locateSucess,locateErr,o)};else console.log("你的瀏覽器不支援喔～～");if(navigator.geolocation)var watch=function(){var o={enableAcuracy:!0,maximumAge:1e3,timeout:6e4};navigator.geolocation.watchPosition(locateSucess,locateErr,o)},stopWatch=navigator.geolocation.clearWatch(watch);else console.log("你的瀏覽器不支援喔～～");$("<button>",{"class":"testClass",id:"ShowTestButton",style:"position:absolute; left:0;top:90vh; z-index:3; display:none",text:"Test Button"}).appendTo("body"),$("#ShowTestButton").click(function(){ShowTestButton()});